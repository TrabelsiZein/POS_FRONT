(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-70d4f87e"],{1148:function(t,e,n){"use strict";var a=n("a691"),i=n("1d80");t.exports="".repeat||function(t){var e=String(i(this)),n="",s=a(t);if(s<0||s==1/0)throw RangeError("Wrong number of repetitions");for(;s>0;(s>>>=1)&&(e+=e))1&s&&(n+=e);return n}},"13d5":function(t,e,n){"use strict";var a=n("23e7"),i=n("d58f").left,s=n("a640"),o=n("ae40"),r=n("2d00"),c=n("605d"),l=s("reduce"),u=o("reduce",{1:0}),d=!c&&r>79&&r<83;a({target:"Array",proto:!0,forced:!l||!u||d},{reduce:function(t){return i(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},"216b":function(t,e,n){},"223c":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"toastification"},[n("div",{staticClass:"d-flex align-items-start"},[n("b-avatar",{staticClass:"mr-75 flex-shrink-0",attrs:{variant:t.variant,size:"1.8rem"}},[n("feather-icon",{attrs:{icon:t.icon,size:"15"}})],1),n("div",{staticClass:"d-flex flex-grow-1"},[n("div",[t.title?n("h5",{staticClass:"mb-0 font-weight-bolder toastification-title",class:"text-"+t.variant,domProps:{textContent:t._s(t.title)}}):t._e(),t.text?n("small",{staticClass:"d-inline-block text-body",domProps:{textContent:t._s(t.text)}}):t._e()]),n("span",{staticClass:"cursor-pointer toastification-close-icon ml-auto ",on:{click:function(e){return t.$emit("close-toast")}}},[t.hideClose?t._e():n("feather-icon",{staticClass:"text-body",attrs:{icon:"XIcon"}})],1)])],1)])},i=[],s=n("e8a3"),o={components:{BAvatar:s["a"]},props:{variant:{type:String,default:"primary"},icon:{type:String,default:null},title:{type:String,default:null},text:{type:String,default:null},hideClose:{type:Boolean,default:!1}}},r=o,c=(n("2edd"),n("2877")),l=Object(c["a"])(r,a,i,!1,null,"55dd3057",null);e["default"]=l.exports},"2edd":function(t,e,n){"use strict";n("216b")},"408a":function(t,e,n){var a=n("c6b6");t.exports=function(t){if("number"!=typeof t&&"Number"!=a(t))throw TypeError("Incorrect invocation");return+t}},4958:function(t,e,n){"use strict";n("e91d")},"4e82":function(t,e,n){"use strict";var a=n("23e7"),i=n("1c0b"),s=n("7b0b"),o=n("d039"),r=n("a640"),c=[],l=c.sort,u=o((function(){c.sort(void 0)})),d=o((function(){c.sort(null)})),m=r("sort"),h=u||!d||!m;a({target:"Array",proto:!0,forced:h},{sort:function(t){return void 0===t?l.call(s(this)):l.call(s(this),i(t))}})},"5e89":function(t,e,n){var a=n("861d"),i=Math.floor;t.exports=function(t){return!a(t)&&isFinite(t)&&i(t)===t}},"6f31":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"pos-container"},[n("b-row",{staticClass:"pos-content"},[n("b-col",{staticClass:"items-column",attrs:{cols:"12",md:"8",lg:"9"}},[n("div",{staticClass:"items-section",class:{"compact-mode":t.compactMode}},[n("div",{staticClass:"items-header"},[n("div",{staticClass:"input-row"},[n("div",{staticClass:"input-col barcode-col"},[n("b-input-group",[n("b-input-group-prepend",[n("span",{staticClass:"input-group-text"},[n("feather-icon",{attrs:{icon:"HashIcon",size:"16"}})],1)]),n("b-form-input",{ref:"barcodeInput",staticClass:"barcode-scanner-input",attrs:{placeholder:"Scan barcode (or type and press Enter)...",disabled:t.barcodeScanning,autofocus:""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleBarcodeScan(e)},input:t.onBarcodeInput,focus:function(e){return t.setActiveInput("barcode")}},model:{value:t.barcodeInput,callback:function(e){t.barcodeInput=e},expression:"barcodeInput"}}),n("b-input-group-append",[n("b-button",{attrs:{variant:"primary",disabled:t.barcodeScanning||!t.barcodeInput.trim()},on:{click:t.handleBarcodeScan}},[t.barcodeScanning?n("b-spinner",{staticClass:"mr-1",attrs:{small:""}}):n("feather-icon",{attrs:{icon:"SearchIcon"}})],1)],1)],1)],1),n("div",{staticClass:"input-col search-col"},[n("b-input-group",[n("b-input-group-prepend",[n("span",{staticClass:"input-group-text"},[n("feather-icon",{attrs:{icon:"SearchIcon",size:"16"}})],1)]),n("b-form-input",{attrs:{placeholder:t.searchPlaceholder},on:{input:t.handleSearchInput,focus:function(e){return t.setActiveInput("search")}},model:{value:t.searchQuery,callback:function(e){t.searchQuery=e},expression:"searchQuery"}}),n("b-input-group-append",[n("b-button",{attrs:{variant:"outline-secondary",disabled:!t.searchQuery.trim()},on:{click:t.clearSearch}},[n("feather-icon",{attrs:{icon:"XIcon"}})],1)],1)],1)],1)]),n("div",{staticClass:"hierarchy-controls"},[n("div",{staticClass:"hierarchy-group"},[t.canNavigateBack?n("b-button",{attrs:{size:"sm",variant:"outline-secondary"},on:{click:t.navigateBack}},[n("feather-icon",{staticClass:"mr-50",attrs:{icon:"ArrowLeftIcon",size:"14"}}),t._v(" Back ")],1):t._e(),n("div",{staticClass:"breadcrumb-trail"},[n("span",{staticClass:"breadcrumb-chip",class:{active:t.isFamiliesView},on:{click:t.resetToFamilies}},[n("feather-icon",{staticClass:"mr-25",attrs:{icon:"LayersIcon",size:"14"}}),t._v(" Families ")],1),t.selectedFamily?[n("span",{staticClass:"breadcrumb-separator"},[n("feather-icon",{attrs:{icon:"ChevronRightIcon",size:"14"}})],1),n("span",{staticClass:"breadcrumb-chip",class:{active:t.isSubFamiliesView&&!t.selectedSubFamily},on:{click:t.returnToSelectedFamily}},[n("feather-icon",{staticClass:"mr-25",attrs:{icon:"GridIcon",size:"14"}}),t._v(" "+t._s(t.selectedFamily.name)+" ")],1)]:t._e(),t.selectedSubFamily?[n("span",{staticClass:"breadcrumb-separator"},[n("feather-icon",{attrs:{icon:"ChevronRightIcon",size:"14"}})],1),n("span",{staticClass:"breadcrumb-chip active"},[n("feather-icon",{staticClass:"mr-25",attrs:{icon:"PackageIcon",size:"14"}}),t._v(" "+t._s(t.selectedSubFamily.name)+" ")],1)]:t._e()],2)],1),n("b-button",{staticClass:"compact-toggle",attrs:{size:"sm",variant:t.compactMode?"outline-primary":"primary"},on:{click:t.toggleCompactMode}},[n("feather-icon",{staticClass:"mr-50",attrs:{icon:t.compactMode?"MaximizeIcon":"MinimizeIcon",size:"14"}}),t._v(" "+t._s(t.compactMode?"Comfort view":"Compact view")+" ")],1)],1)]),n("div",{staticClass:"items-body"},[n("div",{staticClass:"items-grid-wrapper"},[t.gridLoading?n("div",{staticClass:"grid-status"},[n("b-spinner",{staticClass:"mb-1"}),n("p",{staticClass:"mb-0"},[t._v("Loading "+t._s(t.currentLevelLabel.toLowerCase())+"...")])],1):0===t.filteredGridItems.length?n("div",{staticClass:"grid-status empty-state"},[n("feather-icon",{staticClass:"text-muted mb-1",attrs:{icon:t.gridStatusIcon,size:"48"}}),n("p",{staticClass:"mb-0"},[t._v("No "+t._s(t.currentLevelLabel.toLowerCase())+" found")]),n("small",{staticClass:"text-muted"},[t._v("Try a different selection or clear the search")])],1):n("div",{staticClass:"items-grid"},t._l(t.filteredGridItems,(function(e){return n("div",{key:e.id,staticClass:"item-card",class:{"category-card":!t.isItemsView},on:{click:function(n){return t.onGridEntryClick(e)}}},[t.isItemsView?[n("div",{staticClass:"item-image"},[n("feather-icon",{attrs:{icon:"PackageIcon",size:"34"}})],1),n("div",{staticClass:"item-details"},[n("h5",[t._v(t._s(e.name))]),n("p",{staticClass:"item-code"},[t._v(t._s(e.itemCode))]),n("p",{staticClass:"item-price"},[t._v(t._s(t.formatTunCurrency(t.getUnitPriceWithVat(e)))+" TTC")]),null!==e.stockQuantity?n("p",{staticClass:"item-stock",class:t.getStockClass(e.stockQuantity)},[n("feather-icon",{staticClass:"mr-25",attrs:{icon:t.getStockIcon(e.stockQuantity),size:"12"}}),t._v(" Stock: "+t._s(e.stockQuantity)+" ")],1):t._e()])]:[n("div",{staticClass:"category-card-content"},[n("div",{staticClass:"category-icon"},[n("feather-icon",{attrs:{icon:t.isFamiliesView?"LayersIcon":"GridIcon",size:"26"}})],1),n("div",{staticClass:"category-title clamp-2"},[t._v(t._s(e.name))])])]],2)})),0)])])]),n("div",{staticClass:"actions-panel inline-panel"},[n("div",{staticClass:"actions-grid"},[n("b-button",{staticClass:"action-btn",attrs:{variant:"primary",block:"",disabled:0===t.cart.length},on:{click:t.proceedToPayment}},[n("feather-icon",{staticClass:"mr-50",attrs:{icon:"CreditCardIcon",size:"16"}}),t._v(" Payment ")],1),n("b-button",{staticClass:"action-btn",attrs:{variant:"outline-primary",block:""},on:{click:t.goToCustomerManagement}},[n("feather-icon",{staticClass:"mr-50",attrs:{icon:"UsersIcon",size:"16"}}),t._v(" Customers ")],1),n("b-button",{staticClass:"action-btn",attrs:{variant:"outline-success",block:""},on:{click:t.goToReturn}},[n("feather-icon",{staticClass:"mr-50",attrs:{icon:"RotateCcwIcon",size:"16"}}),t._v(" Return Products ")],1),n("b-button",{staticClass:"action-btn",attrs:{variant:"outline-warning",block:""},on:{click:t.openPendingTicketsModal}},[n("feather-icon",{staticClass:"mr-50",attrs:{icon:"ClockIcon",size:"16"}}),t._v(" Pending Tickets "),t.pendingTicketsCount>0?n("b-badge",{staticClass:"ml-50",attrs:{variant:"warning"}},[t._v(" "+t._s(t.pendingTicketsCount)+" ")]):t._e()],1),n("b-button",{staticClass:"action-btn",attrs:{variant:"outline-secondary",block:"",disabled:""}},[n("feather-icon",{staticClass:"mr-50",attrs:{icon:"ListIcon",size:"16"}}),t._v(" Tickets List (soon) ")],1),n("b-button",{staticClass:"action-btn",attrs:{variant:"outline-danger",block:""},on:{click:function(e){t.showCloseSessionModal=!0}}},[n("feather-icon",{staticClass:"mr-50",attrs:{icon:"PowerIcon",size:"16"}}),t._v(" Close Session ")],1)],1)])]),n("b-col",{staticClass:"cart-section",attrs:{cols:"12",md:"4",lg:"3"}},[n("div",{ref:"cartList",staticClass:"cart-items",class:{"cart-items--scrolled":t.cartScrollShadow}},[0===t.cart.length?n("div",{staticClass:"empty-cart"},[n("feather-icon",{staticClass:"mb-1 text-muted",attrs:{icon:"ShoppingBagIcon",size:"36"}}),n("p",{staticClass:"mb-25"},[t._v("Cart is empty")]),n("small",{staticClass:"text-muted d-block mb-1"},[t._v("Scan a barcode or tap a product to add it.")]),t.pendingTicketsCount>0?n("b-button",{attrs:{size:"sm",variant:"outline-primary"},on:{click:t.openPendingTicketsModal}},[t._v(" View Pending Tickets ("+t._s(t.pendingTicketsCount)+") ")]):t._e()],1):t._e(),t._l(t.cart,(function(e,a){return n("div",{key:a,staticClass:"cart-item",class:{highlighted:t.highlightedItemId===e.id}},[n("div",{staticClass:"cart-item-header"},[n("div",{staticClass:"cart-item-title"},[n("h6",[t._v(t._s(e.name))])]),n("div",{staticClass:"cart-item-total"},[e.discountPercentage||e.discountAmount?n("div",{staticClass:"discounted-total"},[n("span",{staticClass:"original-amount"},[t._v(t._s(t.formatTunCurrency(t.getLineTotalWithVat(e,!1))))]),n("span",{staticClass:"total-amount"},[t._v(t._s(t.formatTunCurrency(t.getLineTotalWithVat(e,!0))))])]):n("span",{staticClass:"total-amount"},[t._v(t._s(t.formatTunCurrency(t.getLineTotalWithVat(e,!0))))])])]),n("div",{staticClass:"cart-item-breakdown"},[n("div",{staticClass:"breakdown-row"},[n("span",{staticClass:"breakdown-label"},[t._v("Unit Price:")]),n("span",{staticClass:"breakdown-value"},[t._v(t._s(t.formatShortTun(e.unitPrice))+" HT")]),n("span",{staticClass:"breakdown-value secondary"},[t._v(t._s(t.formatVatPercentage(e))+"% VAT")]),n("span",{staticClass:"breakdown-value primary"},[t._v(t._s(t.formatShortTun(t.getUnitPriceWithVat(e)))+" TTC")])]),e.discountPercentage||e.discountAmount?n("div",{staticClass:"breakdown-row discount-row"},[n("feather-icon",{staticClass:"breakdown-icon",attrs:{icon:"PercentIcon",size:"14"}}),n("span",{staticClass:"breakdown-label"},[t._v("Discount:")]),n("span",{staticClass:"breakdown-value discount"},[t._v(" "+t._s(e.discountPercentage?t.formatDiscountPercentage(e.discountPercentage)+"%":t.formatShortTun(e.discountAmount))+" ")])],1):t._e()]),n("div",{staticClass:"cart-item-controls"},[n("div",{staticClass:"quantity-controls"},[n("b-button",{staticClass:"qty-btn",attrs:{variant:"outline-primary",size:"sm"},on:{click:function(e){return t.decreaseQuantity(a)}}},[t._v(" - ")]),n("span",{staticClass:"quantity"},[t._v(t._s(e.quantity))]),n("b-button",{staticClass:"qty-btn",attrs:{variant:"outline-primary",size:"sm"},on:{click:function(e){return t.increaseQuantity(a)}}},[t._v(" + ")])],1),n("div",{staticClass:"action-buttons"},[n("b-button",{staticClass:"discount-btn",attrs:{variant:"outline-info",size:"sm",title:e.discountPercentage||e.discountAmount?"Edit discount":"Add discount"},on:{click:function(e){return t.openLineDiscountModal(a)}}},[n("feather-icon",{attrs:{icon:"PercentIcon",size:"14"}}),e.discountPercentage||e.discountAmount?n("span",{staticClass:"discount-badge"},[t._v(" "+t._s(e.discountPercentage?t.formatDiscountPercentage(e.discountPercentage)+"%":t.formatShortTun(e.discountAmount))+" ")]):t._e()],1),n("b-button",{staticClass:"remove-btn",attrs:{variant:"outline-danger",size:"sm"},on:{click:function(e){return t.removeFromCart(a)}}},[n("feather-icon",{attrs:{icon:"Trash2Icon",size:"14"}})],1)],1)])])}))],2),n("div",{staticClass:"cart-summary"},[n("div",{staticClass:"cart-summary-header"},[n("span",{staticClass:"cart-summary-title"},[t._v("Cart "+t._s(t.cartCount>0?"("+t.cartCount+")":""))]),t.cart.length>0?n("b-button",{staticClass:"cart-clear-btn",attrs:{variant:"outline-secondary",size:"sm"},on:{click:t.clearCart}},[t._v(" Clear ")]):t._e()],1),n("div",{staticClass:"summary-row"},[n("span",[t._v("Items:")]),n("span",[t._v(t._s(t.cart.length)+" ("+t._s(t.cartCount)+" units)")])]),n("div",{staticClass:"summary-row"},[n("span",[t._v("Subtotal:")]),n("span",[t._v(t._s(t.formatTunCurrency(t.subtotal)))])]),n("div",{staticClass:"summary-row"},[n("span",[t._v("Tax:")]),n("span",[t._v(t._s(t.formatTunCurrency(t.taxAmount)))])]),t.headerDiscountAmount>0?n("div",{staticClass:"summary-row discount-row"},[n("span",[t._v("Discount:")]),n("span",{staticClass:"text-danger"},[t._v("-"+t._s(t.formatTunCurrency(t.headerDiscountAmount)))])]):t._e(),n("div",{staticClass:"summary-row total"},[n("span",[t._v("Total:")]),n("span",[t._v(t._s(t.formatTunCurrency(t.totalAmount)))])])]),n("div",{staticClass:"keyboard-toggle"},[n("b-button",{staticClass:"keyboard-toggle-btn",class:{"keyboard-active":t.showKeyboard},attrs:{variant:"outline-secondary",block:""},on:{click:t.toggleKeyboard}},[n("feather-icon",{staticClass:"mr-50",attrs:{icon:t.showKeyboard?"ChevronDownIcon":"ChevronUpIcon",size:"16"}}),t._v(" "+t._s(t.showKeyboard?"Hide Keyboard":"Show Keyboard")+" ")],1)],1),n("transition",{attrs:{name:"keyboard-fade"}},[t.showKeyboard?n("div",{staticClass:"virtual-keyboard"},[n("div",{staticClass:"keyboard-header"},[n("strong",[t._v("Numeric Keyboard")]),n("b-button",{staticClass:"keyboard-close-btn",attrs:{size:"sm",variant:"outline-secondary"},on:{click:t.toggleKeyboard}},[n("feather-icon",{attrs:{icon:"XIcon",size:"14"}})],1)],1),n("div",{staticClass:"keyboard-grid"},t._l([1,2,3,4,5,6,7,8,9,".",0,"⌫"],(function(e){return n("button",{key:e,staticClass:"keyboard-key",class:{"key-decimal":"."===e,"key-backspace":"⌫"===e},attrs:{type:"button"},on:{click:function(n){return t.handleKeyboardPress(e)}}},[t._v(" "+t._s(e)+" ")])})),0),n("div",{staticClass:"keyboard-actions"},[n("button",{staticClass:"keyboard-action-btn",attrs:{type:"button"},on:{click:function(e){return t.handleKeyboardPress("CLEAR")}}},[t._v(" Clear ")]),n("button",{staticClass:"keyboard-action-btn",attrs:{type:"button"},on:{click:function(e){return t.handleKeyboardPress("BACK")}}},[n("feather-icon",{attrs:{icon:"DeleteIcon",size:"16"}}),t._v(" Back ")],1),n("button",{staticClass:"keyboard-action-btn keyboard-action-enter",attrs:{type:"button"},on:{click:function(e){return t.handleKeyboardPress("ENTER")}}},[n("feather-icon",{attrs:{icon:"CheckIcon",size:"16"}}),t._v(" Enter ")],1)])]):t._e()])],1)],1),n("b-modal",{attrs:{id:"pending-tickets-modal",title:"Pending Tickets",size:"xl"},on:{show:t.loadPendingTickets,hide:t.resetPendingTickets},model:{value:t.showPendingTicketsModal,callback:function(e){t.showPendingTicketsModal=e},expression:"showPendingTicketsModal"}},[t.loadingPendingTickets?n("div",{staticClass:"text-center py-4"},[n("b-spinner",{staticClass:"align-middle"}),n("p",{staticClass:"mt-2"},[t._v("Loading pending tickets...")])],1):0===t.pendingTickets.length?n("div",{staticClass:"text-center py-4"},[n("feather-icon",{staticClass:"text-success mb-3",attrs:{icon:"CheckCircleIcon",size:"48"}}),n("h5",[t._v("No Pending Tickets")]),n("p",{staticClass:"text-muted"},[t._v("All tickets are completed")])],1):n("div",{staticClass:"pending-tickets-list"},t._l(t.pendingTickets,(function(e){return n("b-card",{key:e.id,staticClass:"mb-3 ticket-card"},[n("div",{staticClass:"d-flex justify-content-between align-items-start mb-2"},[n("div",[n("h6",{staticClass:"mb-1"},[t._v("Ticket: "+t._s(e.salesNumber))]),n("small",{staticClass:"text-muted"},[t._v(" Created: "+t._s(t.formatDateTime(e.salesDate))+" ")])]),n("b-badge",{attrs:{variant:"warning"}},[t._v("PENDING")])],1),n("div",{staticClass:"ticket-items mb-2"},[n("h6",{staticClass:"small font-weight-bold mb-1"},[t._v("Items:")]),t._l(e.salesLines,(function(e,a){return n("div",{key:a,staticClass:"ticket-item-line"},[n("span",[t._v(t._s(e.item.name))]),n("span",{staticClass:"float-right"},[t._v(" "+t._s(e.quantity)+" x TND "+t._s(t.formatPrice(e.unitPrice))+" = TND "+t._s(t.formatPrice(e.lineTotal))+" ")])])}))],2),n("div",{staticClass:"ticket-summary"},[n("div",{staticClass:"d-flex justify-content-between"},[n("span",[t._v("Subtotal:")]),n("span",[t._v("TND "+t._s(t.formatPrice(e.subtotal)))])]),n("div",{staticClass:"d-flex justify-content-between"},[n("span",[t._v("Tax:")]),n("span",[t._v("TND "+t._s(t.formatPrice(e.taxAmount)))])]),n("div",{staticClass:"d-flex justify-content-between font-weight-bold"},[n("span",[t._v("Total:")]),n("span",[t._v("TND "+t._s(t.formatPrice(e.totalAmount)))])])]),n("div",{staticClass:"mt-3 d-flex gap-2"},[n("b-button",{staticClass:"flex-grow-1",attrs:{variant:"primary",size:"sm"},on:{click:function(n){return t.retrievePendingTicket(e)}}},[n("feather-icon",{staticClass:"mr-1",attrs:{icon:"ArrowRightIcon",size:"14"}}),t._v(" Continue ")],1),n("b-button",{attrs:{variant:"danger",size:"sm"},on:{click:function(n){return t.confirmDeletePendingTicket(e)}}},[n("feather-icon",{attrs:{icon:"TrashIcon",size:"14"}})],1)],1)])})),1)]),n("b-modal",{attrs:{id:"close-session-modal",title:"Close Cashier Session",size:"xl","ok-disabled":!t.canCloseSession,"ok-variant":"danger"},on:{ok:t.closeSession,cancel:t.resetCloseSessionForm,hide:t.resetCloseSessionForm,shown:t.onCloseSessionModalShown},scopedSlots:t._u([{key:"modal-ok",fn:function(){return[n("feather-icon",{staticClass:"mr-50",attrs:{icon:"PowerIcon",size:"16"}}),t._v(" Close Session ")]},proxy:!0}]),model:{value:t.showCloseSessionModal,callback:function(e){t.showCloseSessionModal=e},expression:"showCloseSessionModal"}},[n("div",{staticClass:"cash-count-section"},[n("div",{staticClass:"d-flex justify-content-between align-items-center mb-4"},[n("div",[n("h5",{staticClass:"mb-1"},[t._v("Payment Count Details")]),n("p",{staticClass:"text-muted small mb-0"},[t._v("Count and record all payment methods for this session")])]),n("b-button",{staticClass:"shadow-sm",attrs:{variant:"primary",size:"sm"},on:{click:t.addCashCountLine}},[n("feather-icon",{staticClass:"mr-50",attrs:{icon:"PlusIcon",size:"14"}}),t._v(" Add Line ")],1)],1),n("div",{staticClass:"cash-count-table-container"},[t.closeSessionData.cashCountLines.length>0?n("b-table",{staticClass:"mb-0",attrs:{items:t.closeSessionData.cashCountLines,fields:t.cashCountFields,striped:"",bordered:"",small:"",responsive:""},scopedSlots:t._u([{key:"cell(denominationValue)",fn:function(e){return[n("b-input-group",{attrs:{prepend:"TND",size:"sm"}},[n("b-form-input",{attrs:{type:"number",step:"0.01",min:"0",size:"sm",placeholder:"0.00"},on:{input:t.updateCashCountTotals},model:{value:e.item.denominationValue,callback:function(n){t.$set(e.item,"denominationValue",t._n(n))},expression:"row.item.denominationValue"}})],1)]}},{key:"cell(quantity)",fn:function(e){return[n("b-form-input",{attrs:{type:"number",min:"1",size:"sm",placeholder:"0"},on:{input:t.updateCashCountTotals},model:{value:e.item.quantity,callback:function(n){t.$set(e.item,"quantity",t._n(n))},expression:"row.item.quantity"}})]}},{key:"cell(paymentMethod)",fn:function(e){return[n("b-form-select",{attrs:{options:t.paymentMethodOptionsWithCash,"value-field":"id","text-field":"name",size:"sm"},on:{change:t.updateCashCountTotals},model:{value:e.item.paymentMethodId,callback:function(n){t.$set(e.item,"paymentMethodId",n)},expression:"row.item.paymentMethodId"}})]}},{key:"cell(lineTotal)",fn:function(e){return[n("strong",{staticClass:"text-primary"},[t._v("TND "+t._s(t.formatPrice(e.item.denominationValue*e.item.quantity)))])]}},{key:"cell(actions)",fn:function(e){return[n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"text-danger p-0",attrs:{variant:"link",size:"sm",title:"Remove line"},on:{click:function(n){return t.removeCashCountLine(e.index)}}},[n("feather-icon",{attrs:{icon:"XIcon",size:"16"}})],1)]}}],null,!1,1717590983)}):n("div",{staticClass:"text-center text-muted py-5"},[n("feather-icon",{staticClass:"mb-2 text-muted",attrs:{icon:"FileTextIcon",size:"48"}}),n("p",{staticClass:"mb-1"},[t._v("No payment count lines added yet")]),n("p",{staticClass:"small mb-0"},[t._v('Click "Add Line" to start counting payments')])],1)],1),t.closeSessionData.cashCountLines.length>0?n("div",{staticClass:"cash-count-total mt-4"},[n("b-card",{staticClass:"border-primary"},[n("div",{staticClass:"d-flex justify-content-between align-items-center"},[n("div",[n("strong",{staticClass:"text-muted d-block mb-1",staticStyle:{"font-size":"0.9rem"}},[t._v("Total Counted")]),n("strong",{staticClass:"text-primary",staticStyle:{"font-size":"1.5rem"}},[t._v(" TND "+t._s(t.formatPrice(t.calculatedTotalCash))+" ")])]),n("feather-icon",{staticClass:"text-primary",attrs:{icon:"DollarSignIcon",size:"32"}})],1)])],1):t._e(),n("b-form-group",{staticClass:"mt-4",attrs:{label:"Notes (optional)","label-for":"close-notes"}},[n("b-form-textarea",{attrs:{id:"close-notes",placeholder:"Enter any notes about the payment count...",rows:"3"},model:{value:t.closeSessionData.notes,callback:function(e){t.$set(t.closeSessionData,"notes",e)},expression:"closeSessionData.notes"}})],1)],1)]),n("b-modal",{attrs:{id:"discount-modal",title:"Apply Discount",size:"md","ok-disabled":!t.canApplyDiscount},on:{ok:t.applyLineDiscount,hide:t.resetDiscountForm},scopedSlots:t._u([{key:"modal-ok",fn:function(){return[t._v(" Apply Discount ")]},proxy:!0},{key:"modal-cancel",fn:function(){return[t._v(" Cancel ")]},proxy:!0}]),model:{value:t.showDiscountModal,callback:function(e){t.showDiscountModal=e},expression:"showDiscountModal"}},[null!==t.discountModalItemIndex?n("div",[t.getDiscountModalItem()?n("div",{staticClass:"mb-3"},[n("strong",[t._v(t._s(t.getDiscountModalItem().name))]),n("div",{staticClass:"text-muted small"},[t._v("Original Line Total: "+t._s(t.formatTunCurrency(t.getOriginalLineTotal())))])]):t._e(),n("b-form-group",{attrs:{label:"Discount Type"}},[n("b-form-radio-group",{attrs:{options:[{text:"Percentage (%)",value:"percentage"},{text:"Amount (TND)",value:"amount"}]},model:{value:t.discountType,callback:function(e){t.discountType=e},expression:"discountType"}})],1),n("b-form-group",{attrs:{label:"percentage"===t.discountType?"Discount Percentage":"Discount Amount"}},[n("b-input-group",[n("b-form-input",{attrs:{type:"number",step:"0.01",min:0,max:"percentage"===t.discountType?100:t.getOriginalLineTotal(),placeholder:(t.discountType,"0.00")},model:{value:t.discountValue,callback:function(e){t.discountValue=t._n(e)},expression:"discountValue"}}),n("b-input-group-append",[n("span",{staticClass:"input-group-text"},[t._v(t._s("percentage"===t.discountType?"%":"TND"))])])],1)],1),n("b-alert",{staticClass:"mt-3",attrs:{variant:"info",show:""}},[n("div",{staticClass:"d-flex justify-content-between mb-1"},[n("span",[t._v("Original Total:")]),n("strong",[t._v(t._s(t.formatTunCurrency(t.getOriginalLineTotal())))])]),n("div",{staticClass:"d-flex justify-content-between mb-1"},[n("span",[t._v("Discount:")]),n("strong",{staticClass:"text-danger"},[t._v("-"+t._s(t.formatTunCurrency(t.getCalculatedDiscount())))])]),n("hr",{staticClass:"my-2"}),n("div",{staticClass:"d-flex justify-content-between"},[n("span",[n("strong",[t._v("New Line Total:")])]),n("strong",{staticClass:"text-success"},[t._v(t._s(t.formatTunCurrency(t.getNewLineTotal())))])])])],1):t._e()])],1)},i=[],s=n("b85c"),o=n("c7eb"),r=n("1da1"),c=n("2909"),l=(n("a4d3"),n("e01a"),n("99af"),n("4de4"),n("7db0"),n("c740"),n("caad"),n("d81d"),n("13d5"),n("fb6a"),n("4e82"),n("a434"),n("b0c0"),n("8ba4"),n("aff5"),n("b680"),n("d3b7"),n("2532"),n("498a"),n("7100")),u=n("223c"),d={name:"ItemSelection",data:function(){return{families:[],subFamilies:[],items:[],searchQuery:"",barcodeInput:"",barcodeScanning:!1,itemsWithBarcodes:[],currentView:"families",selectedFamily:null,selectedSubFamily:null,gridLoading:!1,subFamilyCache:{},itemCache:{},showCloseSessionModal:!1,showPendingTicketsModal:!1,showDiscountModal:!1,discountModalItemIndex:null,discountType:"percentage",discountValue:null,pendingTickets:[],loadingPendingTickets:!1,pendingTicketsCount:0,pendingTicketsInterval:null,ticketToDelete:null,closeSessionData:{notes:"",cashCountLines:[]},keyboardLayout:[["7","8","9"],["4","5","6"],["1","2","3"],["0","00","."],["CLEAR","BACK","ENTER"]],activeInput:"barcode",showKeyboard:!1,loadingSession:!1,highlightedItemId:null,highlightTimer:null,cartScrollShadow:!1,compactMode:!1,paymentMethods:[],cashCountFields:[{key:"denominationValue",label:"Value",sortable:!1,thClass:"text-nowrap"},{key:"quantity",label:"Quantity",sortable:!1,thClass:"text-nowrap"},{key:"paymentMethod",label:"Payment Method",sortable:!1,thClass:"text-nowrap"},{key:"lineTotal",label:"Line Total",sortable:!1,thClass:"text-nowrap text-right",tdClass:"text-right"},{key:"actions",label:"",sortable:!1,thClass:"text-center",tdClass:"text-center"}]}},computed:{isFamiliesView:function(){return"families"===this.currentView},isSubFamiliesView:function(){return"subFamilies"===this.currentView},isItemsView:function(){return"items"===this.currentView},canNavigateBack:function(){return!this.isFamiliesView},currentGridItems:function(){return this.isItemsView?this.items:this.isSubFamiliesView?this.subFamilies:this.families},filteredGridItems:function(){var t=this,e=this.currentGridItems||[];if(!this.searchQuery)return e;var n=this.searchQuery.toLowerCase();return this.isItemsView?e.filter((function(e){var a=e.name&&e.name.toLowerCase().includes(n)||e.itemCode&&e.itemCode.toLowerCase().includes(n)||e.barcode&&e.barcode.toLowerCase().includes(n),i=t.itemsWithBarcodes.find((function(t){return t.item.id===e.id}));if(i&&i.barcodes){var s=i.barcodes.some((function(t){return t.barcode&&t.barcode.toLowerCase().includes(n)}));return a||s}return a})):e.filter((function(t){return t.name&&t.name.toLowerCase().includes(n)||t.code&&t.code.toLowerCase().includes(n)||t.description&&t.description.toLowerCase().includes(n)}))},currentLevelLabel:function(){return this.isItemsView?"Products":this.isSubFamiliesView?"Sub families":"Families"},searchPlaceholder:function(){return this.isItemsView?"Search products by name or code...":this.isSubFamiliesView?"Search sub families...":"Search families..."},gridStatusIcon:function(){return this.isItemsView?"PackageIcon":this.isSubFamiliesView?"GridIcon":"LayersIcon"},cart:function(){return this.$store.state.pos.cart||[]},cartCount:function(){return this.cart.reduce((function(t,e){return t+(e.quantity||0)}),0)},subtotal:function(){var t=this;return this.cart.reduce((function(e,n){var a=n.unitPrice*n.quantity,i=0;if(n.discountPercentage)i=a*(n.discountPercentage/100);else if(n.discountAmount){var s=t.getVatPercent(n);i=n.discountAmount/(1+s/100)}return e+(a-i)}),0)},taxAmount:function(){var t=this;return this.cart.reduce((function(e,n){var a=n.unitPrice*n.quantity,i=0;if(n.discountPercentage)i=a*(n.discountPercentage/100);else if(n.discountAmount){var s=t.getVatPercent(n);i=n.discountAmount/(1+s/100)}var o=a-i,r=t.getVatPercent(n);return e+o*(r/100)}),0)},totalAmount:function(){var t=this;return this.cart.reduce((function(e,n){return e+t.getLineTotalWithVat(n,!0)}),0)},headerDiscountAmount:function(){var t,e=null===(t=this.$store.state.pos)||void 0===t?void 0:t.orderSummary;if(!e)return 0;var n=this.totalAmount;return e.discountPercent&&e.discountPercent>0?n*(e.discountPercent/100):e.discountAmount&&e.discountAmount>0?e.discountAmount:0},canApplyDiscount:function(){if(null===this.discountModalItemIndex||null===this.discountValue||this.discountValue<=0)return!1;if("percentage"===this.discountType&&this.discountValue>100)return!1;if("amount"===this.discountType){var t=this.getOriginalLineTotal();return this.discountValue<=t}return!0},pendingTicketId:function(){return this.$store.state.pos.pendingTicketId},currentSession:function(){return this.$store.state.pos.currentSession},paymentMethodOptions:function(){return this.paymentMethods.filter((function(t){return!1!==t.active}))},paymentMethodOptionsWithCash:function(){var t={id:null,name:"Cash"};return[t].concat(Object(c["a"])(this.paymentMethodOptions))},calculatedTotalCash:function(){return this.closeSessionData.cashCountLines.reduce((function(t,e){var n=parseFloat(e.denominationValue)||0,a=parseInt(e.quantity)||0;return t+n*a}),0)},canCloseSession:function(){return this.closeSessionData.cashCountLines.length>0&&this.closeSessionData.cashCountLines.every((function(t){return t.denominationValue&&t.denominationValue>0&&t.quantity&&t.quantity>0}))}},mounted:function(){var t=this;document.body.classList.add("pos-no-scroll"),this.loadCurrentSession(),this.loadFamilies(),this.loadPendingTicketsCount(),this.$nextTick((function(){t.$refs.barcodeInput&&t.$refs.barcodeInput.focus()})),this.$root.$on("open-close-session-modal",(function(){t.showCloseSessionModal=!0})),this.pendingTicketsInterval=setInterval((function(){t.loadPendingTicketsCount()}),1e4),this.$refs.cartList&&(this.$refs.cartList.addEventListener("scroll",this.handleCartScroll,{passive:!0}),this.$nextTick((function(){t.handleCartScroll()})))},beforeDestroy:function(){document.body.classList.remove("pos-no-scroll"),this.pendingTicketsInterval&&clearInterval(this.pendingTicketsInterval),this.$root.$off("open-close-session-modal"),this.$refs.cartList&&this.$refs.cartList.removeEventListener("scroll",this.handleCartScroll),this.highlightTimer&&clearTimeout(this.highlightTimer)},methods:{getStockClass:function(t){return null===t||void 0===t?"stock-unknown":0===t?"stock-out":t<10?"stock-low":"stock-ok"},getStockIcon:function(t){return null===t||void 0===t?"HelpCircleIcon":0===t?"XCircleIcon":t<10?"AlertTriangleIcon":"CheckCircleIcon"},toggleCompactMode:function(){this.compactMode=!this.compactMode},getVatPercent:function(t){if(!t)return 0;var e=t.defaultVAT;return parseFloat(e)||0},getUnitVatAmount:function(t){var e=parseFloat(t.unitPrice)||0,n=this.getVatPercent(t);return e*(n/100)},formatShortTun:function(t){var e=parseFloat(t)||0;return e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},formatVatPercentage:function(t){var e=this.getVatPercent(t);return e?Number.isInteger(e)?e:e.toFixed(2):0},formatDiscountPercentage:function(t){if(!t&&0!==t)return"0";var e=parseFloat(t)||0;return e.toFixed(3)},getUnitPriceWithVat:function(t){var e=parseFloat(t.unitPrice)||0,n=this.getVatPercent(t);return e*(1+n/100)},getLineVatAmount:function(t){var e=parseFloat(t.unitPrice)||0,n=this.getVatPercent(t),a=t.quantity||0;return e*(n/100)*a},getLineTotalWithVat:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t.quantity||0,a=this.getUnitPriceWithVat(t)*n;if(e&&(t.discountPercentage||t.discountAmount)){var i=0;return t.discountAmount?i=t.discountAmount:t.discountPercentage&&(i=a*(t.discountPercentage/100)),Math.max(0,a-i)}return a},loadFamilies:function(){var t=this;return Object(r["a"])(Object(o["a"])().mark((function e(){var n,a;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.gridLoading=!0,e.prev=1,e.next=4,t.$http.get("/item-family");case 4:n=e.sent,a=Array.isArray(n.data)?n.data:[],t.families=a.filter((function(t){return!1!==t.active})).sort((function(t,e){return(t.name||"").localeCompare(e.name||"",void 0,{sensitivity:"base"})})).sort((function(t,e){var n="number"===typeof t.displayOrder?t.displayOrder:Number.MAX_SAFE_INTEGER,a="number"===typeof e.displayOrder?e.displayOrder:Number.MAX_SAFE_INTEGER;return n-a})),e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](1),console.error("Error loading item families:",e.t0),t.$toast({component:u["default"],props:{title:"Error",icon:"XIcon",text:"Failed to load item families",variant:"danger"}});case 13:return e.prev=13,t.gridLoading=!1,e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})))()},loadSubFamilies:function(t){var e=this;return Object(r["a"])(Object(o["a"])().mark((function n(){var a,i,s;return Object(o["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t){n.next=2;break}return n.abrupt("return");case 2:if(!e.subFamilyCache[t.id]){n.next=5;break}return e.subFamilies=e.subFamilyCache[t.id],n.abrupt("return");case 5:return e.gridLoading=!0,n.prev=6,n.next=9,e.$http.get("/item-sub-family/by-family/".concat(t.id));case 9:a=n.sent,i=Array.isArray(a.data)?a.data:[],s=i.filter((function(t){return!1!==t.active})).sort((function(t,e){return(t.name||"").localeCompare(e.name||"",void 0,{sensitivity:"base"})})),e.subFamilyCache[t.id]=s,e.subFamilies=s,n.next=20;break;case 16:n.prev=16,n.t0=n["catch"](6),console.error("Error loading sub families:",n.t0),e.$toast({component:u["default"],props:{title:"Error",icon:"XIcon",text:"Failed to load sub families",variant:"danger"}});case 20:return n.prev=20,e.gridLoading=!1,n.finish(20);case 23:case"end":return n.stop()}}),n,null,[[6,16,20,23]])})))()},loadItemsBySubFamily:function(t){var e=this;return Object(r["a"])(Object(o["a"])().mark((function n(){var a,i,s;return Object(o["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t){n.next=2;break}return n.abrupt("return");case 2:if(!e.itemCache[t.id]){n.next=5;break}return e.items=e.itemCache[t.id],n.abrupt("return");case 5:return e.gridLoading=!0,n.prev=6,n.next=9,e.$http.get("/item/by-sub-family/".concat(t.id));case 9:a=n.sent,i=Array.isArray(a.data)?a.data:[],s=i.filter((function(t){return!1!==t.active})),e.itemCache[t.id]=s,e.items=s,n.next=20;break;case 16:n.prev=16,n.t0=n["catch"](6),console.error("Error loading items by sub family:",n.t0),e.$toast({component:u["default"],props:{title:"Error",icon:"XIcon",text:"Failed to load products for this sub family",variant:"danger"}});case 20:return n.prev=20,e.gridLoading=!1,n.finish(20);case 23:case"end":return n.stop()}}),n,null,[[6,16,20,23]])})))()},selectFamily:function(t){var e=this;return Object(r["a"])(Object(o["a"])().mark((function n(){return Object(o["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t){n.next=2;break}return n.abrupt("return");case 2:return e.selectedFamily=t,e.selectedSubFamily=null,e.currentView="subFamilies",e.searchQuery="",n.next=8,e.loadSubFamilies(t);case 8:case"end":return n.stop()}}),n)})))()},selectSubFamily:function(t){var e=this;return Object(r["a"])(Object(o["a"])().mark((function n(){return Object(o["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t){n.next=2;break}return n.abrupt("return");case 2:return e.selectedSubFamily=t,e.currentView="items",e.searchQuery="",n.next=7,e.loadItemsBySubFamily(t);case 7:case"end":return n.stop()}}),n)})))()},resetToFamilies:function(){this.currentView="families",this.selectedFamily=null,this.selectedSubFamily=null,this.subFamilies=[],this.items=[],this.searchQuery=""},returnToSelectedFamily:function(){var t=this;return Object(r["a"])(Object(o["a"])().mark((function e(){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.selectedFamily){e.next=2;break}return e.abrupt("return");case 2:if(t.currentView="subFamilies",t.selectedSubFamily=null,t.items=[],t.searchQuery="",!t.subFamilyCache[t.selectedFamily.id]){e.next=10;break}t.subFamilies=t.subFamilyCache[t.selectedFamily.id],e.next=12;break;case 10:return e.next=12,t.loadSubFamilies(t.selectedFamily);case 12:case"end":return e.stop()}}),e)})))()},navigateBack:function(){var t=this;return Object(r["a"])(Object(o["a"])().mark((function e(){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.isItemsView){e.next=5;break}return e.next=3,t.returnToSelectedFamily();case 3:e.next=6;break;case 5:t.isSubFamiliesView&&t.resetToFamilies();case 6:case"end":return e.stop()}}),e)})))()},onGridEntryClick:function(t){this.isItemsView?this.addToCart(t):this.isSubFamiliesView?this.selectSubFamily(t):this.selectFamily(t)},handleSearchInput:function(){},loadItemsWithBarcodes:function(){var t=this;return Object(r["a"])(Object(o["a"])().mark((function e(){var n,a;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$http.get("/item-barcode/items-with-barcodes",{params:{page:0,size:5e3,filterType:"withBarcodes"}});case 3:n=e.sent,a=n.data,a&&Array.isArray(a.content)?t.itemsWithBarcodes=a.content:t.itemsWithBarcodes=a||[],e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error("Error loading items with barcodes:",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},onBarcodeInput:function(){this.barcodeInput&&(this.searchQuery="")},setActiveInput:function(t){this.activeInput=t},handleKeyboardPress:function(t){if(this.activeInput){var e="barcode"===this.activeInput?"barcodeInput":"searchQuery",n=this[e]||"";if("BACK"===t||"⌫"===t)this[e]=n.slice(0,-1);else if("CLEAR"===t)this[e]="";else if("SPACE"===t)this[e]="".concat(n," ");else{if("ENTER"===t)return void("barcodeInput"===e?this.handleBarcodeScan():this.handleSearchInput());"."===t?n.includes(".")||(this[e]=n+"."):this[e]=n+t}"searchQuery"===e&&this.handleSearchInput()}},toggleKeyboard:function(){this.showKeyboard=!this.showKeyboard},openPendingTicketsModal:function(){this.showPendingTicketsModal=!0},handleBarcodeScan:function(){var t=this;return Object(r["a"])(Object(o["a"])().mark((function e(){var n,a,i,r,c,l,d;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.barcodeInput&&""!==t.barcodeInput.trim()){e.next=2;break}return e.abrupt("return");case 2:n=t.barcodeInput.trim(),t.barcodeScanning=!0,e.prev=4,a=null,i=Object(s["a"])(t.itemsWithBarcodes),e.prev=7,i.s();case 9:if((r=i.n()).done){e.next=17;break}if(c=r.value,l=c.barcodes.find((function(t){return t.barcode&&t.barcode.toLowerCase()===n.toLowerCase()})),!l||!1===c.item.active){e.next=15;break}return a=c.item,e.abrupt("break",17);case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e["catch"](7),i.e(e.t0);case 22:return e.prev=22,i.f(),e.finish(22);case 25:if(a||(a=t.items.find((function(t){return t.barcode&&t.barcode.toLowerCase()===n.toLowerCase()&&!1!==t.active}))),a){e.next=37;break}return e.prev=27,e.next=30,t.$http.get("/item-barcode/barcode/".concat(encodeURIComponent(n)));case 30:d=e.sent,d.data&&(a=d.data),e.next=37;break;case 34:e.prev=34,e.t1=e["catch"](27),e.t1.response&&404===e.t1.response.status||console.error("Error finding item by barcode:",e.t1);case 37:a?(t.addToCart(a),t.barcodeInput="",t.$nextTick((function(){t.$refs.barcodeInput&&t.$refs.barcodeInput.focus()}))):(t.$toast({component:u["default"],props:{title:"Barcode Not Found",icon:"AlertCircleIcon",text:"No item found with barcode: ".concat(n),variant:"warning"}}),t.$nextTick((function(){t.$refs.barcodeInput&&(t.$refs.barcodeInput.select(),t.$refs.barcodeInput.focus())}))),e.next=44;break;case 40:e.prev=40,e.t2=e["catch"](4),console.error("Error scanning barcode:",e.t2),t.$toast({component:u["default"],props:{title:"Error",icon:"XIcon",text:"Failed to scan barcode. Please try again.",variant:"danger"}});case 44:return e.prev=44,t.barcodeScanning=!1,e.finish(44);case 47:case"end":return e.stop()}}),e,null,[[4,40,44,47],[7,19,22,25],[27,34]])})))()},clearSearch:function(){this.searchQuery="",this.handleSearchInput()},loadPendingTicketsCount:function(){var t=this;return Object(r["a"])(Object(o["a"])().mark((function e(){var n;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$http.get("/sales-header/pending-sales");case 3:n=e.sent,t.pendingTicketsCount=n.data.length,t.$forceUpdate(),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error("Error loading pending tickets count:",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},loadPendingTickets:function(){var t=this;return Object(r["a"])(Object(o["a"])().mark((function e(){var a;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loadingPendingTickets=!0,e.prev=1,e.next=4,t.$http.get("/sales-header/pending-sales");case 4:a=e.sent,t.pendingTickets=a.data,t.pendingTicketsCount=a.data.length,e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](1),console.error("Error loading pending tickets:",e.t0),t.$toast({component:n("223c").default,props:{title:"Error",icon:"XIcon",text:"Failed to load pending tickets",variant:"danger"}});case 13:return e.prev=13,t.loadingPendingTickets=!1,e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})))()},retrievePendingTicket:function(t){var e=this,n=t.salesLines.map((function(t){return{id:t.item.id,itemCode:t.item.itemCode,name:t.item.name,unitPrice:t.unitPrice,quantity:t.quantity,defaultVAT:t.item.defaultVAT||0,discountPercentage:t.discountPercentage||null,discountAmount:t.discountAmount||null}}));this.$store.dispatch("pos/setCart",n),this.$store.dispatch("pos/setOrderSummary",{subtotal:t.subtotal,taxAmount:t.taxAmount,discountAmount:t.discountAmount||0,discountPercent:t.discountPercentage||0,totalAmount:t.totalAmount}),this.$store.dispatch("pos/setPendingTicketId",t.id),this.showPendingTicketsModal=!1,this.$toast({component:u["default"],props:{title:"Ticket Retrieved",icon:"CheckCircleIcon",text:"Pending ticket ".concat(t.salesNumber," loaded. You can add more items or proceed to payment."),variant:"success"}}),this.$nextTick((function(){e.$refs.barcodeInput&&e.$refs.barcodeInput.focus()}))},resetPendingTickets:function(){this.loadPendingTicketsCount(),this.ticketToDelete=null},confirmDeletePendingTicket:function(t){var e=this;this.ticketToDelete=t,this.$bvModal.msgBoxConfirm('Are you sure you want to delete pending ticket "'.concat(t.salesNumber,'"? This action cannot be undone.'),{title:"Delete Pending Ticket",size:"sm",buttonSize:"sm",okVariant:"danger",okTitle:"Delete",cancelTitle:"Cancel",footerClass:"p-2",hideHeaderClose:!1,centered:!0}).then((function(n){n&&e.deletePendingTicket(t.id),e.ticketToDelete=null}))},deletePendingTicket:function(t){var e=this;return Object(r["a"])(Object(o["a"])().mark((function n(){var a,i;return Object(o["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.$http.post("/sales-header/cancel-pending/".concat(t));case 3:if(a=n.sent,200!==a.status){n.next=10;break}return e.$toast({component:u["default"],props:{title:"Success",icon:"CheckCircleIcon",text:"Pending ticket deleted successfully",variant:"success"}}),n.next=8,e.loadPendingTickets();case 8:e.loadPendingTicketsCount(),e.pendingTicketId===t&&e.$store.dispatch("pos/clearPendingTicketId");case 10:n.next=18;break;case 12:n.prev=12,n.t0=n["catch"](0),console.error("Error deleting pending ticket:",n.t0),i="Failed to delete pending ticket. Please try again.",n.t0.response&&n.t0.response.data&&(i=n.t0.response.data.message||n.t0.response.data||i),e.$toast({component:u["default"],props:{title:"Error",icon:"XIcon",text:i,variant:"danger"}});case 18:case"end":return n.stop()}}),n,null,[[0,12]])})))()},formatDateTime:function(t){if(!t)return"";var e=new Date(t);return e.toLocaleString()},addToCart:function(t){var e=this,n=Object(c["a"])(this.cart),a=n.findIndex((function(e){return e.id===t.id}));if(-1!==a){var i=n[a];i.quantity+=1,n.splice(a,1),n.unshift(i)}else n.unshift({id:t.id,itemCode:t.itemCode,name:t.name,unitPrice:t.unitPrice||0,defaultVAT:t.defaultVAT||0,quantity:1,discountPercentage:null,discountAmount:null});this.$store.dispatch("pos/setCart",n),this.highlightCartItem(t.id),this.$nextTick((function(){e.$refs.cartList&&(e.$refs.cartList.scrollTop=0)})),this.$toast({component:u["default"],props:{title:"Added to Cart",icon:"CheckIcon",text:"".concat(t.name," added to cart"),variant:"success"}},{position:"top-left"})},increaseQuantity:function(t){var e=Object(c["a"])(this.cart);e[t].quantity+=1,this.$store.dispatch("pos/setCart",e)},decreaseQuantity:function(t){var e=Object(c["a"])(this.cart);e[t].quantity>1?(e[t].quantity-=1,this.$store.dispatch("pos/setCart",e)):this.removeFromCart(t)},removeFromCart:function(t){var e=Object(c["a"])(this.cart);e.splice(t,1),this.$store.dispatch("pos/setCart",e)},clearCart:function(){this.$store.dispatch("pos/clearCart"),this.pendingTicketId&&this.$store.dispatch("pos/clearPendingTicketId")},formatPrice:function(t){var e=parseFloat(t)||0;return e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},formatTunCurrency:function(t){var e=parseFloat(t)||0,n=e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return"".concat(n," TND")},highlightCartItem:function(t){var e=this;this.highlightedItemId=t,this.highlightTimer&&clearTimeout(this.highlightTimer),this.highlightTimer=setTimeout((function(){e.highlightedItemId=null,e.highlightTimer=null}),800)},handleCartScroll:function(){this.$refs.cartList&&(this.cartScrollShadow=this.$refs.cartList.scrollTop>0)},proceedToPayment:function(){this.$store.dispatch("pos/setOrderSummary",{subtotal:this.subtotal,taxAmount:this.taxAmount,totalAmount:this.totalAmount}),this.$router.push({name:"pos-payment"})},goToCustomerManagement:function(){this.$router.push({name:"pos-customers",query:{returnTo:"pos-item-selection"}})},goToReturn:function(){this.$router.push({name:"pos-return"})},clearPendingTicket:function(){this.$store.dispatch("pos/clearPendingTicketId"),this.$toast({component:u["default"],props:{title:"Cleared",icon:"InfoIcon",text:"Pending ticket cleared. Starting new sale.",variant:"info"}})},loadCurrentSession:function(){var t=this;return Object(r["a"])(Object(o["a"])().mark((function e(){var n;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loadingSession=!0,e.next=3,t.$store.dispatch("pos/checkSession");case 3:n=e.sent,n||t.$router.push({name:"pos-open-session"}),t.loadingSession=!1;case 6:case"end":return e.stop()}}),e)})))()},loadPaymentMethods:function(){var t=this;this.$http.get("/payment-method").then((function(e){t.paymentMethods=e.data.filter((function(t){return!1!==t.active}))})).catch((function(e){console.error("Error loading payment methods:",e),t.paymentMethods=[{id:1,name:"Cash"},{id:2,name:"Card"}]}))},addCashCountLine:function(){this.closeSessionData.cashCountLines.push({denominationValue:null,quantity:null,paymentMethodId:null,notes:""})},onCloseSessionModalShown:function(){0===this.paymentMethods.length&&this.loadPaymentMethods()},removeCashCountLine:function(t){this.closeSessionData.cashCountLines.splice(t,1),this.updateCashCountTotals()},updateCashCountTotals:function(){this.$forceUpdate()},closeSession:function(){var t=this;return Object(r["a"])(Object(o["a"])().mark((function e(){var a,i,s;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(t.pendingTicketsCount>0)){e.next=4;break}return t.$toast({component:n("223c").default,props:{title:"Cannot Close Session",icon:"AlertCircleIcon",text:"You have ".concat(t.pendingTicketsCount," pending ticket(s). Please complete or cancel all pending tickets before closing the session."),variant:"warning"}}),t.showCloseSessionModal=!1,e.abrupt("return");case 4:if(t.canCloseSession){e.next=7;break}return t.$toast({component:n("223c").default,props:{title:"Error",icon:"XIcon",text:"Please add cash count lines or enter actual cash amount",variant:"danger"}}),e.abrupt("return");case 7:return e.prev=7,a={notes:t.closeSessionData.notes},t.closeSessionData.cashCountLines.length>0&&(a.cashCountLines=t.closeSessionData.cashCountLines.map((function(t){return{denominationValue:parseFloat(t.denominationValue)||0,quantity:parseInt(t.quantity)||0,paymentMethodId:null!==t.paymentMethodId?t.paymentMethodId:null,notes:t.notes||null}}))),e.next=12,t.$http.post("/cashier-session/close",a);case 12:i=e.sent,200===i.status&&(t.$toast({component:u["default"],props:{title:"Success",icon:"CheckCircleIcon",text:"Session closed successfully!",variant:"success"}}),t.$store.dispatch("pos/clearCurrentSession"),t.resetCloseSessionForm(),t.showCloseSessionModal=!1,setTimeout((function(){l["a"].logout(),t.$router.push({name:"login"})}),1500)),e.next=22;break;case 16:e.prev=16,e.t0=e["catch"](7),console.error("Error closing session:",e.t0),s="Failed to close session. Please try again.",e.t0.response&&e.t0.response.data&&(s=e.t0.response.data||s),t.$toast({component:u["default"],props:{title:"Error",icon:"XIcon",text:s,variant:"danger"}});case 22:case"end":return e.stop()}}),e,null,[[7,16]])})))()},resetCloseSessionForm:function(){this.closeSessionData={notes:"",cashCountLines:[]}},openLineDiscountModal:function(t){if(!(t<0||t>=this.cart.length)){this.discountModalItemIndex=t;var e=this.cart[t];e.discountPercentage?(this.discountType="percentage",this.discountValue=e.discountPercentage):e.discountAmount?(this.discountType="amount",this.discountValue=e.discountAmount):(this.discountType="percentage",this.discountValue=null),this.showDiscountModal=!0}},getDiscountModalItem:function(){return null===this.discountModalItemIndex||this.discountModalItemIndex>=this.cart.length?null:this.cart[this.discountModalItemIndex]},getOriginalLineTotal:function(){var t=this.getDiscountModalItem();return t?this.getLineTotalWithVat(t,!1):0},getCalculatedDiscount:function(){if(!this.discountValue||this.discountValue<=0)return 0;var t=this.getOriginalLineTotal();return"percentage"===this.discountType?t*(this.discountValue/100):Math.min(this.discountValue,t)},getNewLineTotal:function(){var t=this.getOriginalLineTotal(),e=this.getCalculatedDiscount();return Math.max(0,t-e)},applyLineDiscount:function(){if(this.canApplyDiscount&&null!==this.discountModalItemIndex){var t=Object(c["a"])(this.cart),e=t[this.discountModalItemIndex],n=this.getLineTotalWithVat(e,!1),a=null,i=null;"percentage"===this.discountType?(a=this.discountValue,i=n*(this.discountValue/100)):(i=Math.min(this.discountValue,n),a=n>0?i/n*100:0),e.discountPercentage=a,e.discountAmount=i,this.$store.dispatch("pos/setCart",t),this.resetDiscountForm()}},resetDiscountForm:function(){this.showDiscountModal=!1,this.discountModalItemIndex=null,this.discountType="percentage",this.discountValue=null}}},m=d,h=(n("e8f7"),n("4958"),n("2877")),p=Object(h["a"])(m,a,i,!1,null,"1dfa5196",null);e["default"]=p.exports},"8ba4":function(t,e,n){var a=n("23e7"),i=n("5e89");a({target:"Number",stat:!0},{isInteger:i})},aff5:function(t,e,n){var a=n("23e7");a({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991})},b680:function(t,e,n){"use strict";var a=n("23e7"),i=n("a691"),s=n("408a"),o=n("1148"),r=n("d039"),c=1..toFixed,l=Math.floor,u=function(t,e,n){return 0===e?n:e%2===1?u(t,e-1,n*t):u(t*t,e/2,n)},d=function(t){var e=0,n=t;while(n>=4096)e+=12,n/=4096;while(n>=2)e+=1,n/=2;return e},m=c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r((function(){c.call({})}));a({target:"Number",proto:!0,forced:m},{toFixed:function(t){var e,n,a,r,c=s(this),m=i(t),h=[0,0,0,0,0,0],p="",f="0",b=function(t,e){var n=-1,a=e;while(++n<6)a+=t*h[n],h[n]=a%1e7,a=l(a/1e7)},v=function(t){var e=6,n=0;while(--e>=0)n+=h[e],h[e]=l(n/t),n=n%t*1e7},g=function(){var t=6,e="";while(--t>=0)if(""!==e||0===t||0!==h[t]){var n=String(h[t]);e=""===e?n:e+o.call("0",7-n.length)+n}return e};if(m<0||m>20)throw RangeError("Incorrect fraction digits");if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return String(c);if(c<0&&(p="-",c=-c),c>1e-21)if(e=d(c*u(2,69,1))-69,n=e<0?c*u(2,-e,1):c/u(2,e,1),n*=4503599627370496,e=52-e,e>0){b(0,n),a=m;while(a>=7)b(1e7,0),a-=7;b(u(10,a,1),0),a=e-1;while(a>=23)v(1<<23),a-=23;v(1<<a),b(1,1),v(2),f=g()}else b(0,n),b(1<<-e,0),f=g()+o.call("0",m);return m>0?(r=f.length,f=p+(r<=m?"0."+o.call("0",m-r)+f:f.slice(0,r-m)+"."+f.slice(r-m))):f=p+f,f}})},b85c:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));n("a4d3"),n("e01a"),n("d28b"),n("d3b7"),n("3ca3"),n("ddb0");var a=n("06c5");function i(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Object(a["a"])(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,s=function(){};return{s:s,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){c=!0,o=t},f:function(){try{r||null==n["return"]||n["return"]()}finally{if(c)throw o}}}}},d58f:function(t,e,n){var a=n("1c0b"),i=n("7b0b"),s=n("44ad"),o=n("50c4"),r=function(t){return function(e,n,r,c){a(n);var l=i(e),u=s(l),d=o(l.length),m=t?d-1:0,h=t?-1:1;if(r<2)while(1){if(m in u){c=u[m],m+=h;break}if(m+=h,t?m<0:d<=m)throw TypeError("Reduce of empty array with no initial value")}for(;t?m>=0:d>m;m+=h)m in u&&(c=n(c,u[m],m,l));return c}};t.exports={left:r(!1),right:r(!0)}},dc1a:function(t,e,n){},e8f7:function(t,e,n){"use strict";n("dc1a")},e91d:function(t,e,n){}}]);
//# sourceMappingURL=chunk-70d4f87e.df2e4650.js.map