(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-eeafe182"],{"129f":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},"216b":function(t,e,s){},"223c":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"toastification"},[s("div",{staticClass:"d-flex align-items-start"},[s("b-avatar",{staticClass:"mr-75 flex-shrink-0",attrs:{variant:t.variant,size:"1.8rem"}},[s("feather-icon",{attrs:{icon:t.icon,size:"15"}})],1),s("div",{staticClass:"d-flex flex-grow-1"},[s("div",[t.title?s("h5",{staticClass:"mb-0 font-weight-bolder toastification-title",class:"text-"+t.variant,domProps:{textContent:t._s(t.title)}}):t._e(),t.text?s("small",{staticClass:"d-inline-block text-body",domProps:{textContent:t._s(t.text)}}):t._e()]),s("span",{staticClass:"cursor-pointer toastification-close-icon ml-auto ",on:{click:function(e){return t.$emit("close-toast")}}},[t.hideClose?t._e():s("feather-icon",{staticClass:"text-body",attrs:{icon:"XIcon"}})],1)])],1)])},i=[],n=s("e8a3"),r={components:{BAvatar:n["a"]},props:{variant:{type:String,default:"primary"},icon:{type:String,default:null},title:{type:String,default:null},text:{type:String,default:null},hideClose:{type:Boolean,default:!1}}},l=r,c=(s("2edd"),s("2877")),o=Object(c["a"])(l,a,i,!1,null,"55dd3057",null);e["default"]=o.exports},"2edd":function(t,e,s){"use strict";s("216b")},"841c":function(t,e,s){"use strict";var a=s("d784"),i=s("825a"),n=s("1d80"),r=s("129f"),l=s("14c3");a("search",1,(function(t,e,s){return[function(e){var s=n(this),a=void 0==e?void 0:e[t];return void 0!==a?a.call(e,s):new RegExp(e)[t](String(s))},function(t){var a=s(e,t,this);if(a.done)return a.value;var n=i(t),c=String(this),o=n.lastIndex;r(o,0)||(n.lastIndex=0);var u=l(n,c);return r(n.lastIndex,o)||(n.lastIndex=o),null===u?-1:u.index}]}))},"851e":function(t,e,s){},bf63:function(t,e,s){"use strict";s("851e")},e3d0:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"tickets-history-container"},[s("div",{staticClass:"page-header"},[s("h2",{staticClass:"mb-0"},[t._v("Tickets History")]),s("b-button",{attrs:{variant:"outline-primary"},on:{click:t.loadTickets}},[s("feather-icon",{attrs:{icon:"RefreshCwIcon",size:"16"}}),t._v(" Refresh ")],1)],1),s("b-card",{staticClass:"mb-2"},[s("div",{attrs:{role:"button",tabindex:"0"},on:{click:t.toggleFilters,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.toggleFilters(e)}}},[s("div",{staticClass:"d-flex align-items-center justify-content-between"},[s("div",{staticClass:"d-flex align-items-center"},[s("feather-icon",{staticClass:"mr-2 text-primary",attrs:{icon:"FilterIcon",size:"18"}}),s("h6",{staticClass:"mb-0 text-primary font-weight-bold"},[t._v(" Filters "),s("span",{staticClass:"text-muted font-weight-normal ml-2"},[t._v("(Total: "+t._s(t.totalRows)+" "+t._s(1===t.totalRows?"ticket":"tickets")+")")])])],1),s("feather-icon",{staticClass:"text-primary",attrs:{icon:t.filtersExpanded?"ChevronUpIcon":"ChevronDownIcon",size:"20"}})],1)]),s("b-collapse",{attrs:{id:"filters-collapse"},model:{value:t.filtersExpanded,callback:function(e){t.filtersExpanded=e},expression:"filtersExpanded"}},[s("div",{staticClass:"pt-2"},[s("b-row",[s("b-col",{staticClass:"mb-2",attrs:{cols:"12",sm:"6",md:"6",lg:"6"}},[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Search","label-for":"search-input"}},[s("b-input-group",[s("b-input-group-prepend",[s("b-input-group-text",{staticClass:"bg-white"},[s("feather-icon",{attrs:{icon:"SearchIcon",size:"16"}})],1)],1),s("b-form-input",{attrs:{id:"search-input",placeholder:"Search by ticket number, customer name..."},on:{input:t.onFilterChange},model:{value:t.filters.search,callback:function(e){t.$set(t.filters,"search",e)},expression:"filters.search"}}),s("b-input-group-append",[s("b-button",{attrs:{variant:"outline-secondary",disabled:!t.filters.search},on:{click:t.clearSearch}},[s("feather-icon",{attrs:{icon:"XIcon",size:"14"}})],1)],1)],1)],1)],1),s("b-col",{staticClass:"mb-2",attrs:{cols:"12",sm:"6",md:"3",lg:"3"}},[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Date From","label-for":"date-from"}},[s("b-input-group",[s("b-input-group-prepend",[s("b-input-group-text",{staticClass:"bg-white"},[s("feather-icon",{attrs:{icon:"CalendarIcon",size:"16"}})],1)],1),s("b-form-input",{attrs:{id:"date-from",type:"date"},on:{input:t.onFilterChange},model:{value:t.filters.dateFrom,callback:function(e){t.$set(t.filters,"dateFrom",e)},expression:"filters.dateFrom"}})],1)],1)],1),s("b-col",{staticClass:"mb-2",attrs:{cols:"12",sm:"6",md:"3",lg:"3"}},[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Date To","label-for":"date-to"}},[s("b-input-group",[s("b-input-group-prepend",[s("b-input-group-text",{staticClass:"bg-white"},[s("feather-icon",{attrs:{icon:"CalendarIcon",size:"16"}})],1)],1),s("b-form-input",{attrs:{id:"date-to",type:"date"},on:{input:t.onFilterChange},model:{value:t.filters.dateTo,callback:function(e){t.$set(t.filters,"dateTo",e)},expression:"filters.dateTo"}})],1)],1)],1)],1),s("b-row",[s("b-col",{staticClass:"mb-2",attrs:{cols:"12",sm:"6",md:"4",lg:"4"}},[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Status","label-for":"status-filter"}},[s("b-input-group",[s("b-input-group-prepend",[s("b-input-group-text",{staticClass:"bg-white"},[s("feather-icon",{attrs:{icon:"TagIcon",size:"16"}})],1)],1),s("b-form-select",{attrs:{id:"status-filter",options:t.statusOptions},on:{input:t.onFilterChange},model:{value:t.filters.status,callback:function(e){t.$set(t.filters,"status",e)},expression:"filters.status"}})],1)],1)],1),s("b-col",{staticClass:"mb-2",attrs:{cols:"12",sm:"6",md:"4",lg:"4"}},[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Sync Status","label-for":"sync-status-filter"}},[s("b-input-group",[s("b-input-group-prepend",[s("b-input-group-text",{staticClass:"bg-white"},[s("feather-icon",{attrs:{icon:"CloudIcon",size:"16"}})],1)],1),s("b-form-select",{attrs:{id:"sync-status-filter",options:t.syncStatusOptions},on:{input:t.onFilterChange},model:{value:t.filters.syncStatus,callback:function(e){t.$set(t.filters,"syncStatus",e)},expression:"filters.syncStatus"}})],1)],1)],1),s("b-col",{staticClass:"mb-2",attrs:{cols:"12",sm:"6",md:"4",lg:"4"}},[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Payment Method","label-for":"payment-method-filter"}},[s("b-input-group",[s("b-input-group-prepend",[s("b-input-group-text",{staticClass:"bg-white"},[s("feather-icon",{attrs:{icon:"CreditCardIcon",size:"16"}})],1)],1),s("b-form-select",{attrs:{id:"payment-method-filter",options:t.paymentMethodOptions},on:{input:t.onFilterChange},model:{value:t.filters.paymentMethodId,callback:function(e){t.$set(t.filters,"paymentMethodId",e)},expression:"filters.paymentMethodId"}})],1)],1)],1),s("b-col",{staticClass:"mb-2",attrs:{cols:"12",sm:"6",md:"4",lg:"4"}},[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Family","label-for":"family-filter"}},[s("b-input-group",[s("b-input-group-prepend",[s("b-input-group-text",{staticClass:"bg-white"},[s("feather-icon",{attrs:{icon:"LayersIcon",size:"16"}})],1)],1),s("b-form-select",{attrs:{id:"family-filter",options:t.familyOptions},on:{input:t.onFamilyChange},model:{value:t.filters.familyId,callback:function(e){t.$set(t.filters,"familyId",e)},expression:"filters.familyId"}})],1)],1)],1),s("b-col",{staticClass:"mb-2",attrs:{cols:"12",sm:"6",md:"4",lg:"4"}},[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Subfamily","label-for":"subfamily-filter"}},[s("b-input-group",[s("b-input-group-prepend",[s("b-input-group-text",{staticClass:"bg-white"},[s("feather-icon",{attrs:{icon:"GridIcon",size:"16"}})],1)],1),s("b-form-select",{attrs:{id:"subfamily-filter",options:t.subFamilyOptions,disabled:"all"===t.filters.familyId},on:{input:t.onSubFamilyChange},model:{value:t.filters.subFamilyId,callback:function(e){t.$set(t.filters,"subFamilyId",e)},expression:"filters.subFamilyId"}})],1)],1)],1)],1)],1)])],1),s("b-card",[s("b-table",{staticClass:"cursor-pointer",attrs:{items:t.tickets,fields:t.ticketFields,striped:"",hover:"",responsive:"",busy:t.loading,"sort-by":t.sortBy,"sort-desc":t.sortDesc,"show-empty":""},on:{"row-clicked":t.viewTicketDetails},scopedSlots:t._u([{key:"table-busy",fn:function(){return[s("div",{staticClass:"text-center my-2"},[s("b-spinner",{staticClass:"align-middle"}),s("strong",[t._v("Loading...")])],1)]},proxy:!0},{key:"empty",fn:function(){return[s("div",{staticClass:"text-center text-muted py-4"},[s("p",[t._v("No tickets found")]),s("p",{staticClass:"small"},[t._v("Try adjusting your filters")])])]},proxy:!0},{key:"cell(salesNumber)",fn:function(e){return[s("strong",{staticClass:"text-primary"},[t._v(t._s(e.item.salesNumber))])]}},{key:"cell(salesDate)",fn:function(e){return[t._v(" "+t._s(t.formatDate(e.item.salesDate))+" ")]}},{key:"cell(customer)",fn:function(e){return[e.item.customer?s("div",[s("div",[s("strong",[t._v(t._s(e.item.customer.name))])]),s("small",{staticClass:"text-muted"},[t._v(t._s(e.item.customer.customerCode))])]):s("span",{staticClass:"text-muted"},[t._v("-")])]}},{key:"cell(totalAmount)",fn:function(e){return[s("strong",[t._v(t._s(t.formatPrice(e.item.totalAmount))+" TND")])]}},{key:"cell(status)",fn:function(e){return[s("b-badge",{attrs:{variant:t.getStatusVariant(e.item.status)}},[t._v(" "+t._s(e.item.status)+" ")])]}},{key:"cell(synchronizationStatus)",fn:function(e){return[s("div",{staticClass:"sync-status-cell"},[s("b-badge",{staticClass:"sync-badge",attrs:{variant:t.getSyncStatusVariant(e.item.synchronizationStatus)}},[s("feather-icon",{staticClass:"mr-1",attrs:{icon:t.getSyncStatusIcon(e.item.synchronizationStatus),size:"12"}}),t._v(" "+t._s(t.formatSyncStatus(e.item.synchronizationStatus))+" ")],1),e.item.erpNo?s("small",{staticClass:"text-muted d-block mt-1"},[t._v(" ERP: "+t._s(e.item.erpNo)+" ")]):t._e()],1)]}}])}),s("div",{staticClass:"mt-3"},[s("b-row",{attrs:{"align-v":"center"}},[s("b-col",{staticClass:"mb-2 mb-md-0",attrs:{cols:"12",md:"6"}},[s("div",{staticClass:"d-flex align-items-center"},[s("label",{staticClass:"mr-2 mb-0",attrs:{for:"per-page-select"}},[t._v("Items per page:")]),s("b-form-select",{staticStyle:{width:"auto"},attrs:{id:"per-page-select",options:t.perPageOptions,size:"sm"},on:{change:t.onPerPageChange},model:{value:t.perPage,callback:function(e){t.perPage=e},expression:"perPage"}})],1)]),s("b-col",{attrs:{cols:"12",md:"6"}},[s("div",{staticClass:"text-center text-md-right"},[s("small",{staticClass:"text-muted"},[t._v(" Showing "+t._s(t.startIndex)+" to "+t._s(t.endIndex)+" of "+t._s(t.totalRows)+" tickets ")])])])],1),s("div",{staticClass:"d-flex justify-content-center mt-2"},[s("b-pagination",{attrs:{"total-rows":t.totalRows,"per-page":t.perPage,align:"center"},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1)],1),s("b-modal",{attrs:{id:"ticket-details-modal",title:"Ticket Details",size:"xl",scrollable:""},on:{hide:t.resetDetailsModal},scopedSlots:t._u([{key:"modal-footer",fn:function(){return[s("b-button",{attrs:{variant:"secondary"},on:{click:function(e){t.showDetailsModal=!1}}},[t._v(" Close ")]),s("b-button",{attrs:{variant:"primary",disabled:t.loading},on:{click:t.printTicket}},[s("feather-icon",{attrs:{icon:"PrinterIcon",size:"16"}}),t._v(" Print Duplicate ")],1)]},proxy:!0}]),model:{value:t.showDetailsModal,callback:function(e){t.showDetailsModal=e},expression:"showDetailsModal"}},[t.selectedTicket?s("div",{staticClass:"ticket-details"},[s("b-card",{staticClass:"mb-3"},[s("b-row",[s("b-col",{attrs:{md:"6"}},[s("div",{staticClass:"detail-item"},[s("strong",[t._v("Ticket Number:")]),s("span",{staticClass:"ml-2"},[t._v(t._s(t.selectedTicket.salesNumber))])]),s("div",{staticClass:"detail-item"},[s("strong",[t._v("Date:")]),s("span",{staticClass:"ml-2"},[t._v(t._s(t.formatDateTime(t.selectedTicket.salesDate)))])]),t.selectedTicket.completedDate?s("div",{staticClass:"detail-item"},[s("strong",[t._v("Completed:")]),s("span",{staticClass:"ml-2"},[t._v(t._s(t.formatDateTime(t.selectedTicket.completedDate)))])]):t._e(),s("div",{staticClass:"detail-item"},[s("strong",[t._v("Status:")]),s("b-badge",{staticClass:"ml-2",attrs:{variant:t.getStatusVariant(t.selectedTicket.status)}},[t._v(" "+t._s(t.selectedTicket.status)+" ")])],1)]),s("b-col",{attrs:{md:"6"}},[t.selectedTicket.customer?s("div",{staticClass:"detail-item"},[s("strong",[t._v("Customer:")]),s("span",{staticClass:"ml-2"},[t._v(" "+t._s(t.selectedTicket.customer.name)+" "),s("small",{staticClass:"text-muted"},[t._v("("+t._s(t.selectedTicket.customer.customerCode)+")")])])]):t._e(),t.selectedTicket.createdByUser?s("div",{staticClass:"detail-item"},[s("strong",[t._v("Cashier:")]),s("span",{staticClass:"ml-2"},[t._v(t._s(t.selectedTicket.createdByUser.fullName||t.selectedTicket.createdByUser.username))])]):t._e(),t.selectedTicket.cashierSession?s("div",{staticClass:"detail-item"},[s("strong",[t._v("Session:")]),s("span",{staticClass:"ml-2"},[t._v(t._s(t.selectedTicket.cashierSession.sessionNumber))])]):t._e()])],1)],1),s("b-card",{staticClass:"mb-3 sync-info-card"},[s("div",{staticClass:"d-flex align-items-center mb-3"},[s("feather-icon",{staticClass:"mr-2 text-primary",attrs:{icon:"CloudIcon",size:"20"}}),s("h5",{staticClass:"mb-0"},[t._v("ERP Synchronization")])],1),s("b-row",[s("b-col",{attrs:{md:"6"}},[s("div",{staticClass:"sync-detail-item"},[s("label",{staticClass:"sync-label"},[t._v("Synchronization Status")]),s("div",{staticClass:"sync-value"},[s("b-badge",{staticClass:"sync-badge-large",attrs:{variant:t.getSyncStatusVariant(t.selectedTicket.synchronizationStatus)}},[s("feather-icon",{staticClass:"mr-1",attrs:{icon:t.getSyncStatusIcon(t.selectedTicket.synchronizationStatus),size:"14"}}),t._v(" "+t._s(t.formatSyncStatus(t.selectedTicket.synchronizationStatus))+" ")],1)],1)])]),s("b-col",{attrs:{md:"6"}},[s("div",{staticClass:"sync-detail-item"},[s("label",{staticClass:"sync-label"},[t._v("ERP Document Number")]),s("div",{staticClass:"sync-value"},[t.selectedTicket.erpNo?s("code",{staticClass:"erp-number"},[t._v(t._s(t.selectedTicket.erpNo))]):s("span",{staticClass:"text-muted"},[t._v("Not synchronized")])])])])],1),t.selectedTicket.salesLines?s("div",{staticClass:"mt-3"},[s("div",{staticClass:"sync-summary"},[s("small",{staticClass:"text-muted"},[t._v(" Lines synchronized: "),s("strong",[t._v(t._s(t.getSyncedLinesCount(t.selectedTicket.salesLines))+" / "+t._s(t.selectedTicket.salesLines.length))])])])]):t._e()],1),s("b-card",{staticClass:"mb-3"},[s("h5",{staticClass:"mb-3"},[t._v("Items")]),s("b-table",{staticClass:"sales-lines-table",attrs:{items:t.selectedTicket.salesLines||[],fields:t.lineFields,striped:"",small:"",responsive:""},scopedSlots:t._u([{key:"cell(item)",fn:function(e){return[s("div",[s("strong",[t._v(t._s(e.item.item.name))]),s("div",{staticClass:"small text-muted"},[t._v(t._s(e.item.item.itemCode))])])]}},{key:"cell(quantity)",fn:function(e){return[t._v(" "+t._s(e.item.quantity)+" ")]}},{key:"cell(unitPrice)",fn:function(e){return[t._v(" "+t._s(t.formatPrice(e.item.unitPrice))+" TND ")]}},{key:"cell(discount)",fn:function(e){return[e.item.discountPercentage||e.item.discountAmount?s("div",[e.item.discountPercentage?s("div",{staticClass:"text-primary"},[t._v(" "+t._s(t.formatPrice(e.item.discountPercentage))+"% ")]):t._e(),e.item.discountAmount?s("div",{staticClass:"text-muted small"},[t._v(" -"+t._s(t.formatPrice(e.item.discountAmount))+" TND ")]):t._e()]):s("span",{staticClass:"text-muted"},[t._v("—")])]}},{key:"cell(vat)",fn:function(e){return[e.item.vatPercent||e.item.vatAmount?s("div",[e.item.vatPercent?s("div",{staticClass:"text-info"},[t._v(" "+t._s(e.item.vatPercent)+"% ")]):t._e(),e.item.vatAmount?s("div",{staticClass:"text-muted small"},[t._v(" "+t._s(t.formatPrice(e.item.vatAmount))+" TND ")]):t._e()]):s("span",{staticClass:"text-muted"},[t._v("—")])]}},{key:"cell(unitPriceIncludingVat)",fn:function(e){return[s("strong",[t._v(t._s(t.formatPrice(e.item.unitPriceIncludingVat))+" TND")])]}},{key:"cell(lineTotalIncludingVat)",fn:function(e){return[s("strong",{staticClass:"text-success"},[t._v(t._s(t.formatPrice(e.item.lineTotalIncludingVat))+" TND")])]}},{key:"cell(synched)",fn:function(e){return[s("b-badge",{staticClass:"sync-indicator",attrs:{variant:e.item.synched?"success":"secondary"}},[s("feather-icon",{staticClass:"mr-1",attrs:{icon:e.item.synched?"CheckIcon":"XIcon",size:"12"}}),t._v(" "+t._s(e.item.synched?"Synced":"Not Synced")+" ")],1)]}}],null,!1,2897501953)})],1),t.selectedTicket.payments&&t.selectedTicket.payments.length>0?s("b-card",{staticClass:"mb-3"},[s("h5",{staticClass:"mb-3"},[t._v("Payments")]),s("b-table",{attrs:{items:t.selectedTicket.payments,fields:t.paymentFields,striped:"",small:"",responsive:""},scopedSlots:t._u([{key:"cell(paymentMethod)",fn:function(e){return[t._v(" "+t._s(e.item.paymentMethod?e.item.paymentMethod.name:"-")+" ")]}},{key:"cell(amount)",fn:function(e){return[s("strong",[t._v(t._s(t.formatPrice(e.item.totalAmount))+" TND")])]}},{key:"cell(reference)",fn:function(e){return[t._v(" "+t._s(e.item.paymentReference||"-")+" ")]}},{key:"cell(synched)",fn:function(e){return[s("b-badge",{staticClass:"sync-indicator",attrs:{variant:e.item.synched?"success":"secondary"}},[s("feather-icon",{staticClass:"mr-1",attrs:{icon:e.item.synched?"CheckIcon":"XIcon",size:"12"}}),t._v(" "+t._s(e.item.synched?"Synced":"Not Synced")+" ")],1)]}}],null,!1,2675268372)})],1):t._e(),s("b-card",[s("h5",{staticClass:"mb-3"},[t._v("Summary")]),s("b-row",[s("b-col",{attrs:{md:"6","offset-md":"6"}},[s("div",{staticClass:"summary-row"},[s("span",[t._v("Subtotal:")]),s("span",[t._v(t._s(t.formatPrice(t.selectedTicket.subtotal))+" TND")])]),t.selectedTicket.taxAmount?s("div",{staticClass:"summary-row"},[s("span",[t._v("Tax:")]),s("span",[t._v(t._s(t.formatPrice(t.selectedTicket.taxAmount))+" TND")])]):t._e(),t.selectedTicket.discountAmount?s("div",{staticClass:"summary-row"},[s("span",[t._v("Discount:")]),s("span",[t._v("-"+t._s(t.formatPrice(t.selectedTicket.discountAmount))+" TND")])]):t._e(),s("div",{staticClass:"summary-row total"},[s("span",[s("strong",[t._v("Total:")])]),s("span",[s("strong",[t._v(t._s(t.formatPrice(t.selectedTicket.totalAmount))+" TND")])])]),t.selectedTicket.paidAmount?s("div",{staticClass:"summary-row"},[s("span",[t._v("Paid:")]),s("span",{staticClass:"text-success"},[t._v(t._s(t.formatPrice(t.selectedTicket.paidAmount))+" TND")])]):t._e(),t.selectedTicket.changeAmount?s("div",{staticClass:"summary-row"},[s("span",[t._v("Change:")]),s("span",{staticClass:"text-info"},[t._v(t._s(t.formatPrice(t.selectedTicket.changeAmount))+" TND")])]):t._e()])],1),t.selectedTicket.notes?s("div",{staticClass:"mt-3"},[s("strong",[t._v("Notes:")]),s("p",{staticClass:"text-muted"},[t._v(t._s(t.selectedTicket.notes))])]):t._e()],1)],1):t._e()])],1)},i=[],n=s("c7eb"),r=s("1da1"),l=s("2909"),c=(s("99af"),s("4de4"),s("a15b9"),s("d81d"),s("fb6a"),s("b0c0"),s("b680"),s("d3b7"),s("ac1f"),s("841c"),s("223c")),o=s("475a"),u=s("62c5"),d=s.n(u),m={name:"TicketsHistory",data:function(){var t=new Date,e=t.toISOString().split("T")[0];return{tickets:[],allTickets:[],filteredTickets:[],loading:!1,sortBy:"salesDate",sortDesc:!0,showDetailsModal:!1,selectedTicket:null,filtersExpanded:!1,currentPage:1,perPage:10,perPageOptions:[{value:10,text:"10"},{value:20,text:"20"},{value:50,text:"50"},{value:100,text:"100"}],paymentMethods:[],families:[],subFamilies:[],filters:{search:"",dateFrom:e,dateTo:e,status:"all",syncStatus:"all",paymentMethodId:"all",familyId:"all",subFamilyId:"all"},statusOptions:[{value:"all",text:"All"},{value:"COMPLETED",text:"Completed"},{value:"PENDING",text:"Pending"},{value:"CANCELLED",text:"Cancelled"}],syncStatusOptions:[{value:"all",text:"All"},{value:"NOT_SYNCHED",text:"Not Synced"},{value:"PARTIALLY_SYNCHED",text:"Partially Synced"},{value:"TOTALLY_SYNCHED",text:"Totally Synced"}],ticketFields:[{key:"salesNumber",label:"Ticket #",sortable:!0},{key:"salesDate",label:"Date",sortable:!0},{key:"customer",label:"Customer",sortable:!1},{key:"totalAmount",label:"Total",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"synchronizationStatus",label:"Sync Status",sortable:!0}],lineFields:[{key:"item",label:"Item"},{key:"quantity",label:"Qty"},{key:"unitPrice",label:"Unit Price HT"},{key:"discount",label:"Discount"},{key:"vat",label:"VAT"},{key:"unitPriceIncludingVat",label:"Unit Price TTC"},{key:"lineTotalIncludingVat",label:"Total TTC"},{key:"synched",label:"Synced",class:"text-center"}],paymentFields:[{key:"paymentMethod",label:"Payment Method"},{key:"amount",label:"Amount"},{key:"reference",label:"Reference"},{key:"notes",label:"Notes"},{key:"synched",label:"Synced",class:"text-center"}]}},computed:{totalRows:function(){return this.filteredTickets.length},paymentMethodOptions:function(){return[{value:"all",text:"All Payment Methods"}].concat(Object(l["a"])(this.paymentMethods.map((function(t){return{value:t.id,text:t.name}}))))},familyOptions:function(){return[{value:"all",text:"All Families"}].concat(Object(l["a"])(this.families.map((function(t){return{value:t.id,text:t.name}}))))},subFamilyOptions:function(){var t=this,e=this.subFamilies.filter((function(e){return"all"===t.filters.familyId||e.itemFamily&&e.itemFamily.id===t.filters.familyId})).map((function(t){return{value:t.id,text:t.name}}));return[{value:"all",text:"all"===this.filters.familyId?"Select a family first":"All Subfamilies"}].concat(Object(l["a"])(e))},startIndex:function(){return 0===this.totalRows?0:(this.currentPage-1)*this.perPage+1},endIndex:function(){return Math.min(this.currentPage*this.perPage,this.totalRows)}},watch:{currentPage:function(){this.updatePaginatedTickets()},perPage:function(){this.currentPage>Math.ceil(this.totalRows/this.perPage)&&(this.currentPage=Math.max(1,Math.ceil(this.totalRows/this.perPage))),this.updatePaginatedTickets()}},mounted:function(){this.loadPaymentMethods(),this.loadFamilies(),this.loadSubFamilies(),this.loadTickets()},methods:{loadFamilies:function(){var t=this;return Object(r["a"])(Object(n["a"])().mark((function e(){var s;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$http.get("/item-family");case 3:s=e.sent,t.families=Array.isArray(s.data)?s.data:[],e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.error("Error loading families:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},loadSubFamilies:function(){var t=this;return Object(r["a"])(Object(n["a"])().mark((function e(){var s;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$http.get("/item-sub-family");case 3:s=e.sent,t.subFamilies=Array.isArray(s.data)?s.data:[],e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.error("Error loading subfamilies:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},loadPaymentMethods:function(){var t=this;return Object(r["a"])(Object(n["a"])().mark((function e(){var s;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$http.get("/payment-method");case 3:s=e.sent,200===s.status&&(t.paymentMethods=(s.data||[]).filter((function(t){return!1!==t.active}))),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.error("Error loading payment methods:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},loadTickets:function(){var t=this;return Object(r["a"])(Object(n["a"])().mark((function e(){var s,a;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,s={},t.filters.search&&(s.search=t.filters.search),t.filters.dateFrom&&(s.dateFrom=t.filters.dateFrom),t.filters.dateTo&&(s.dateTo=t.filters.dateTo),t.filters.status&&"all"!==t.filters.status&&(s.status=t.filters.status),t.filters.syncStatus&&"all"!==t.filters.syncStatus&&(s.syncStatus=t.filters.syncStatus),t.filters.paymentMethodId&&"all"!==t.filters.paymentMethodId&&(s.paymentMethodId=t.filters.paymentMethodId),e.next=11,t.$http.get("/sales-header/history",{params:s});case 11:a=e.sent,200===a.status&&(t.allTickets=a.data||[],t.applyLocalFilters(),1!==t.currentPage?t.currentPage=1:t.updatePaginatedTickets()),e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](1),console.error("Error loading tickets:",e.t0),t.$toast({component:c["default"],props:{title:"Error",icon:"XIcon",text:"Failed to load tickets. Please try again.",variant:"danger"}});case 19:return e.prev=19,t.loading=!1,e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[1,15,19,22]])})))()},updatePaginatedTickets:function(){var t=this;if(this.filteredTickets||(this.filteredTickets=[]),0!==this.filteredTickets.length){var e=Math.max(1,Math.ceil(this.filteredTickets.length/this.perPage));if(this.currentPage>e)return this.currentPage=e,void this.$nextTick((function(){t.updatePaginatedTickets()}));this.currentPage<1&&(this.currentPage=1);var s=(this.currentPage-1)*this.perPage,a=s+this.perPage;this.tickets=this.filteredTickets.slice(s,a),this.$nextTick((function(){window.scrollTo({top:0,behavior:"smooth"})}))}else this.tickets=[]},onPerPageChange:function(){this.currentPage=1,this.updatePaginatedTickets()},viewTicketDetails:function(t){var e=this;return Object(r["a"])(Object(n["a"])().mark((function s(){var a;return Object(n["a"])().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return e.loading=!0,s.prev=1,s.next=4,e.$http.get("/sales-header/".concat(t.id,"/details"));case 4:a=s.sent,200===a.status&&(e.selectedTicket=a.data,e.showDetailsModal=!0),s.next=12;break;case 8:s.prev=8,s.t0=s["catch"](1),console.error("Error loading ticket details:",s.t0),e.$toast({component:c["default"],props:{title:"Error",icon:"XIcon",text:"Failed to load ticket details. Please try again.",variant:"danger"}});case 12:return s.prev=12,e.loading=!1,s.finish(12);case 15:case"end":return s.stop()}}),s,null,[[1,8,12,15]])})))()},resetDetailsModal:function(){this.selectedTicket=null},onFilterChange:function(){this.loadTickets()},onFamilyChange:function(){this.filters.subFamilyId="all",this.applyLocalFilters()},onSubFamilyChange:function(){this.applyLocalFilters()},applyLocalFilters:function(){var t=this,e="all"!==this.filters.familyId,s="all"!==this.filters.subFamilyId;if(!e&&!s)return this.filteredTickets=Object(l["a"])(this.allTickets),void this.updatePaginatedTickets();this.filteredTickets=this.allTickets.filter((function(a){var i=Array.isArray(a.salesLines)?a.salesLines:[];return 0===i.length?!e&&!s:i.some((function(a){var i,n,r=a.item||{},l=(null===(i=r.itemFamily)||void 0===i?void 0:i.id)||r.itemFamilyId,c=(null===(n=r.itemSubFamily)||void 0===n?void 0:n.id)||r.itemSubFamilyId,o=!e||l===t.filters.familyId,u=!s||c===t.filters.subFamilyId;return o&&u}))})),this.currentPage=1,this.updatePaginatedTickets()},clearSearch:function(){this.filters.search="",this.loadTickets()},toggleFilters:function(){this.filtersExpanded=!this.filtersExpanded},resetFilters:function(){var t=new Date,e=t.toISOString().split("T")[0];this.filters={search:"",dateFrom:e,dateTo:e,status:"all",syncStatus:"all",paymentMethodId:"all"},this.loadTickets()},formatDate:function(t){if(!t)return"-";var e=new Date(t);return e.toLocaleDateString()+" "+e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},formatDateTime:function(t){if(!t)return"-";var e=new Date(t);return e.toLocaleString()},formatPrice:function(t){return t?parseFloat(t).toFixed(2):"0.00"},getStatusVariant:function(t){switch(t){case"COMPLETED":return"success";case"PENDING":return"warning";case"CANCELLED":return"danger";default:return"secondary"}},formatSyncStatus:function(t){return t?t.split("_").map((function(t){return t.charAt(0)+t.slice(1).toLowerCase()})).join(" "):"Not Synced"},getSyncStatusVariant:function(t){if(!t)return"secondary";switch(t){case"TOTALLY_SYNCHED":return"success";case"PARTIALLY_SYNCHED":return"warning";case"NOT_SYNCHED":return"secondary";default:return"secondary"}},getSyncStatusIcon:function(t){if(!t)return"XIcon";switch(t){case"TOTALLY_SYNCHED":return"CheckCircleIcon";case"PARTIALLY_SYNCHED":return"AlertCircleIcon";case"NOT_SYNCHED":return"XCircleIcon";default:return"XCircleIcon"}},getSyncedLinesCount:function(t){return t&&Array.isArray(t)?t.filter((function(t){return!0===t.synched})).length:0},printTicket:function(){this.selectedTicket&&this.printTicketData(this.selectedTicket)},printTicketData:function(t){var e=this;return Object(r["a"])(Object(n["a"])().mark((function s(){var a,i,r,l,u,m;return Object(n["a"])().wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(t){s.next=2;break}return s.abrupt("return");case 2:return console.log("Printing duplicate ticket:",t),a=e.$root.constructor||e.$options._base,i=a.extend(o["a"]),r=new i({parent:e,propsData:{saleData:t,isDuplicate:!0}}),r.$mount(),s.next=9,e.$nextTick();case 9:return s.next=11,new Promise((function(t){return setTimeout(t,200)}));case 11:if(l=t.salesNumber||null,l&&r.$el)try{u=r.$el.querySelector(".barcode-svg"),u&&d()(u,l,{format:"CODE128",width:1.5,height:40,displayValue:!1,margin:5,background:"#ffffff",lineColor:"#000000"})}catch(n){console.error("Error generating barcode:",n)}if(m=window.open("","_blank"),m){s.next=17;break}return e.$toast({component:c["default"],props:{title:"Print Error",icon:"XIcon",text:"Please allow popups to print receipts",variant:"warning"}}),s.abrupt("return");case 17:m.document.write("\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <title>Receipt - ".concat(t.salesNumber," - DUPLICATE</title>\n          <style>\n            @page {\n              size: 80mm auto;\n              margin: 0;\n            }\n            body {\n              margin: 0;\n              padding: 10mm;\n              font-family: 'Courier New', monospace;\n              font-size: 12px;\n              line-height: 1.4;\n              background: white;\n              color: black;\n            }\n            .receipt-template {\n              width: 100%;\n              max-width: 80mm;\n            }\n            .receipt-header { margin-bottom: 15px; }\n            .receipt-header h2 { font-size: 16px; margin: 5px 0; font-weight: bold; text-align: center; }\n            .receipt-header h3 { font-size: 14px; margin: 5px 0; font-weight: bold; text-align: center; }\n            .duplicate-badge { \n              background: #ff0000 !important; \n              color: white !important; \n              font-weight: bold !important; \n              text-align: center !important; \n              padding: 10px !important; \n              margin: 10px 0 !important;\n              font-size: 18px !important;\n              border: 3px solid #000 !important;\n              letter-spacing: 2px !important;\n            }\n            .receipt-divider { margin: 8px 0; text-align: center; }\n            .receipt-info, .receipt-items, .receipt-totals, .receipt-payments { margin-bottom: 10px; }\n            .receipt-row { display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 12px; }\n            .receipt-row.total { font-weight: bold; font-size: 14px; margin-top: 8px; }\n            .receipt-row .label { text-align: left; }\n            .receipt-row .value { text-align: right; font-weight: bold; }\n            .item-name { flex: 2; text-align: left; }\n            .item-qty { flex: 0.5; text-align: center; }\n            .item-total { flex: 1; text-align: right; }\n            .item-code { font-size: 10px; color: #666; margin-left: 10px; margin-bottom: 6px; }\n            .receipt-section-header { font-weight: bold; text-align: center; margin: 8px 0; }\n            .receipt-footer { margin-top: 20px; text-align: center; font-size: 11px; }\n            .receipt-item { margin-bottom: 8px; }\n            .payment-entry { margin-bottom: 8px; }\n            .receipt-barcode { margin: 15px 0; text-align: center; }\n            .barcode-container { display: flex; justify-content: center; align-items: center; margin: 10px 0; }\n            .barcode-svg { max-width: 100%; height: auto; }\n            .barcode-text { font-size: 11px; font-weight: bold; margin-top: 5px; letter-spacing: 1px; text-align: center; }\n          </style>\n        </head>\n        <body>\n          ").concat(r.$el.outerHTML,"\n        </body>\n        </html>\n      ")),m.document.close(),setTimeout((function(){m.focus(),m.print(),setTimeout((function(){m.close(),r&&r.$el&&r.$destroy()}),1e3)}),500);case 20:case"end":return s.stop()}}),s)})))()}}},p=m,f=(s("bf63"),s("2877")),b=Object(f["a"])(p,a,i,!1,null,"171d0f00",null);e["default"]=b.exports}}]);
//# sourceMappingURL=chunk-eeafe182.c5415486.js.map